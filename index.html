<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Estoque</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-4xl font-bold text-center mb-6">Controle de Estoque</h1>

    <div class="mb-6 p-4 bg-white rounded shadow">
      <h2 class="text-2xl font-semibold mb-2">Resumo por Código</h2>
      <table class="min-w-full table-auto border border-gray-300 text-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-4 py-2 border">Código</th>
            <th class="px-4 py-2 border">Descrição</th>
            <th class="px-4 py-2 border">Total em Estoque</th>
          </tr>
        </thead>
        <tbody id="resumo-estoque-body">
          <!-- Dados dinâmicos -->
        </tbody>
      </table>
    </div>

    <div class="p-4 bg-white rounded shadow">
      <h2 class="text-2xl font-semibold mb-2">Movimentações</h2>
      <table class="min-w-full table-auto border border-gray-300 text-sm">
        <thead class="bg-gray-200">
          <tr>
            <th class="px-4 py-2 border">Código</th>
            <th class="px-4 py-2 border">Descrição</th>
            <th class="px-4 py-2 border">Endereço</th>
            <th class="px-4 py-2 border">Lote</th>
            <th class="px-4 py-2 border">Tipo</th>
            <th class="px-4 py-2 border">Data</th>
            <th class="px-4 py-2 border">Quantidade</th>
          </tr>
        </thead>
        <tbody id="tabela-estoque-body">
          <!-- Dados dinâmicos -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const supabaseUrl = 'https://msctrhembaolsklvibzb.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1zY3RyaGVtYmFvbHNrbHZpYnpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MDM3NDYsImV4cCI6MjA2MzI3OTc0Nn0.7deozexjvrqmsAZzeRd5gguoZG4g-Yi3LoYlRjMBm1U';
    const tableName = 'estoque';

    async function carregarDados() {
      const resposta = await fetch(`${supabaseUrl}/rest/v1/${tableName}?select=*`, {
        headers: {
          'apikey': supabaseKey,
          'Authorization': `Bearer ${supabaseKey}`
        }
      });

      const dados = await resposta.json();

      const tabela = document.getElementById('tabela-estoque-body');
      const resumo = document.getElementById('resumo-estoque-body');

      tabela.innerHTML = '';
      resumo.innerHTML = '';

      const resumoPorCodigo = {};

      dados.forEach(item => {
        const { codigo, descricao, endereco, lote, tipo, data, quantidade } = item;

        // Preencher tabela principal
        const linha = `
          <tr>
            <td class="border px-4 py-2">${codigo}</td>
            <td class="border px-4 py-2">${descricao}</td>
            <td class="border px-4 py-2">${endereco}</td>
            <td class="border px-4 py-2">${lote}</td>
            <td class="border px-4 py-2">${tipo}</td>
            <td class="border px-4 py-2">${data}</td>
            <td class="border px-4 py-2">${quantidade}</td>
          </tr>
        `;
        tabela.innerHTML += linha;

        // Calcular resumo por código
        if (!resumoPorCodigo[codigo]) {
          resumoPorCodigo[codigo] = {
            descricao: descricao,
            total: 0
          };
        }

        if (tipo.toLowerCase() === 'entrada') {
          resumoPorCodigo[codigo].total += quantidade;
        } else if (tipo.toLowerCase() === 'saida') {
          resumoPorCodigo[codigo].total -= quantidade;
        }
      });

      // Preencher tabela de resumo
      Object.keys(resumoPorCodigo).forEach(codigo => {
        const item = resumoPorCodigo[codigo];
        const linhaResumo = `
          <tr>
            <td class="border px-4 py-2">${codigo}</td>
            <td class="border px-4 py-2">${item.descricao}</td>
            <td class="border px-4 py-2 font-bold">${item.total}</td>
          </tr>
        `;
        resumo.innerHTML += linhaResumo;
      });
    }

    carregarDados();
  </script>
</body>
</html>
